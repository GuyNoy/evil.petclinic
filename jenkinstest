node {

stage('Clone repository') {
 checkout scm       
    }


    //$PC_USER,$PC_PASS,$PC_CONSOLE when Galileo is released. 
    
    stage('Download latest twistcli') {
        withCredentials([usernamePassword(credentialsId: 'twistlock_creds', passwordVariable: 'PC_PASS', usernameVariable: 'PC_USER')]) {
            sh 'curl -k -u $PC_USER:$PC_PASS --output ./twistcli https://$PC_CONSOLE/api/v1/util/twistcli'
            sh 'sudo chmod a+x ./twistcli'
        }
    }

    stage('Check image Git dependencies has no vulnerabilities') {
                 sh "./twistcli coderepo scan --u $TL_USER --p $TL_PASS --address https://$TL_CONSOLE --details rbenavente/evil.petclinic"

        prismaCloudPublish resultsFilePattern: 'prisma-cloud-scan-results.json'
        }
    
    }
  
